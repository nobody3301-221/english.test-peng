<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>管理者用 単語リスト編集ページ</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; }
    table { border-collapse: collapse; margin-bottom: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; }
    input[type="text"] { width: 120px; }
  </style>
</head>
<body>
  <h1>単語リスト管理ページ</h1>
  <div id="wordListBox">ロード中...</div>
  <h2>新しい単語追加</h2>
  <form id="addForm">
    日本語: <input type="text" id="newJp">
    英語: <input type="text" id="newEn">
    <button type="submit">追加</button>
  </form>
  <button id="downloadBtn">編集したリストをダウンロード</button>
  <script>
    let words = [];
    let wordListBox = document.getElementById('wordListBox');

    // words.txtの読み込み
    fetch('words.txt')
      .then(res => res.text())
      .then(text => {
        words = text
          .split('\n')
          .map(line => line.trim())
          .filter(line => line)
          .map(line => {
            const [jp, en] = line.split(',');
            return { jp: jp, en: en };
          });
        renderTable();
      })
      .catch(() => {
        wordListBox.textContent = 'words.txtの読み込みに失敗しました。';
      });

    // 単語リスト表示
    function renderTable() {
      let html = `<table><tr><th>#</th><th>日本語</th><th>英語</th><th>削除</th></tr>`;
      words.forEach((w, i) => {
        html += `<tr>
          <td>${i+1}</td>
          <td>${w.jp}</td>
          <td>${w.en}</td>
          <td><button onclick="deleteWord(${i})">削除</button></td>
        </tr>`;
      });
      html += "</table>";
      wordListBox.innerHTML = html;
    }

    // 削除機能
    window.deleteWord = function(idx) {
      words.splice(idx, 1);
      renderTable();
    };

    // 追加機能
    document.getElementById('addForm').onsubmit = function(e) {
      e.preventDefault();
      const jp = document.getElementById('newJp').value.trim();
      const en = document.getElementById('newEn').value.trim();
      if(jp && en) {
        words.push({ jp: jp, en: en });
        document.getElementById('newJp').value = '';
        document.getElementById('newEn').value = '';
        renderTable();
      }
    };

    // ダウンロード機能
    document.getElementById('downloadBtn').onclick = function() {
      const txt = words.map(w => `${w.jp},${w.en}`).join('\n');
      const blob = new Blob([txt], {type: "text/plain"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = "words.txt";
      a.click();
      URL.revokeObjectURL(url);
    };
  </script>
</body>
</html>
