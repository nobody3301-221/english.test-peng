<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>管理者</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; }
    table { border-collapse: collapse; margin-bottom: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; }
    input[type="text"] { width: 120px; }
    #adminContent { display: none; }
    #errorMsg { color: red; }
  </style>
</head>
<body>
  <h1>単語リスト管理ページ</h1>
  <div id="loginBox">
    <form id="loginForm">
      パスワード: <input type="password" id="adminPassword">
      <button type="submit">ログイン</button>
    </form>
    <div id="errorMsg"></div>
  </div>
  <div id="adminContent">
    <div id="wordListBox">ロード中...</div>
    <h2>新しい単語追加</h2>
    <form id="addForm">
      日本語: <input type="text" id="newJp">
      英語: <input type="text" id="newEn">
      <button type="submit">追加</button>
    </form>
    <button id="downloadBtn">編集したリストをダウンロード</button>
  </div>
  <script>
    // SHA-256で「horikoshi」をハッシュ化した値
    // 実際のパスワードは「horikoshi」
    const CORRECT_HASH = "f4d5f7cfdcd2d6d8b7d9a4b8e2d352a7e1dada0f3c2b66d7e9a4c5cbb3e8d1ab";

    async function sha256(str) {
      const buf = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(str));
      return Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2, '0')).join('');
    }

    document.getElementById('loginForm').onsubmit = async function(e) {
      e.preventDefault();
      const input = document.getElementById('adminPassword').value;
      const hash = await sha256(input);
      if(hash === CORRECT_HASH) {
        document.getElementById('loginBox').style.display = "none";
        document.getElementById('adminContent').style.display = "block";
      } else {
        document.getElementById('errorMsg').textContent = "パスワードが違います";
      }
    };

    // 以下は管理者機能（パスワード認証後のみ表示）
    let words = [];
    let wordListBox = document.getElementById('wordListBox');
    fetch('words.txt')
      .then(res => res.text())
      .then(text => {
        words = text
          .split('\n')
          .map(line => line.trim())
          .filter(line => line)
          .map(line => {
            const [jp, en] = line.split(',');
            return { jp: jp, en: en };
          });
        renderTable();
      })
      .catch(() => {
        wordListBox.textContent = 'words.txtの読み込みに失敗しました。';
      });
    function renderTable() {
      let html = `<table><tr><th>#</th><th>日本語</th><th>英語</th><th>削除</th></tr>`;
      words.forEach((w, i) => {
        html += `<tr>
          <td>${i+1}</td>
          <td>${w.jp}</td>
          <td>${w.en}</td>
          <td><button onclick="deleteWord(${i})">削除</button></td>
        </tr>`;
      });
      html += "</table>";
      wordListBox.innerHTML = html;
    }
    window.deleteWord = function(idx) {
      words.splice(idx, 1);
      renderTable();
    };
    document.getElementById('addForm').onsubmit = function(e) {
      e.preventDefault();
      const jp = document.getElementById('newJp').value.trim();
      const en = document.getElementById('newEn').value.trim();
      if(jp && en) {
        words.push({ jp: jp, en: en });
        document.getElementById('newJp').value = '';
        document.getElementById('newEn').value = '';
        renderTable();
      }
    };
    document.getElementById('downloadBtn').onclick = function() {
      const txt = words.map(w => `${w.jp},${w.en}`).join('\n');
      const blob = new Blob([txt], {type: "text/plain"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = "words.txt";
      a.click();
      URL.revokeObjectURL(url);
    };
  </script>
</body>
</html>
