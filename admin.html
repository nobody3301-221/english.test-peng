<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>管理者用 単語リスト編集ページ</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; }
    table { border-collapse: collapse; margin-bottom: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; }
    input[type="text"] { width: 120px; }
    #adminContent { display: none; }
    #errorMsg { color: red; }
    .edit-btn { margin-right: 8px; }
  </style>
</head>
<body>
  <h1>単語リスト管理ページ</h1>

  <!-- パスワード認証フォーム -->
  <div id="loginBox">
    <form id="loginForm">
      パスワード: <input type="password" id="adminPassword">
      <button type="submit">ログイン</button>
    </form>
    <div id="errorMsg"></div>
  </div>

  <!-- 管理者用コンテンツ -->
  <div id="adminContent">
    <h2>単語リスト編集</h2>
    <div id="wordListBox">ロード中...</div>
    <h3>新しい単語追加</h3>
    <form id="addForm">
      日本語: <input type="text" id="newJp">
      英語: <input type="text" id="newEn">
      <button type="submit">追加</button>
    </form>
    <button id="downloadBtn">編集したリストをダウンロード</button>
  </div>

  <script>
    const CORRECT_PASSWORD = "horikoshi";

    document.getElementById('loginForm').onsubmit = function(e) {
      e.preventDefault();
      const input = document.getElementById('adminPassword').value;
      if(input === CORRECT_PASSWORD) {
        document.getElementById('loginBox').style.display = "none";
        document.getElementById('adminContent').style.display = "block";
      } else {
        document.getElementById('errorMsg').textContent = "パスワードが違います";
      }
    };

    // 編集機能
    let words = [];
    let wordListBox = document.getElementById('wordListBox');
    fetch('words.txt')
      .then(res => res.text())
      .then(text => {
        words = text
          .split('\n')
          .map(line => line.trim())
          .filter(line => line)
          .map(line => {
            const [jp, en] = line.split(',');
            return { jp: jp, en: en };
          });
        renderTable();
      })
      .catch(() => {
        wordListBox.textContent = 'words.txtの読み込みに失敗しました。';
      });

    function renderTable() {
      let html = `<table><tr><th>#</th><th>日本語</th><th>英語</th><th>編集</th><th>削除</th></tr>`;
      words.forEach((w, i) => {
        html += `<tr>
          <td>${i+1}</td>
          <td><input type="text" value="${w.jp}" onchange="window.updateWord(${i}, 'jp', this.value)" /></td>
          <td><input type="text" value="${w.en}" onchange="window.updateWord(${i}, 'en', this.value)" /></td>
          <td><button class="edit-btn" onclick="window.editWord(${i})">編集</button></td>
          <td><button class="edit-btn" onclick="window.deleteWord(${i})">削除</button></td>
        </tr>`;
      });
      html += "</table>";
      wordListBox.innerHTML = html;
    }
    window.deleteWord = function(idx) {
      words.splice(idx, 1);
      renderTable();
    };
    window.updateWord = function(idx, key, val) {
      words[idx][key] = val;
      renderTable();
    };
    window.editWord = function(idx) {
      alert('セルを書き換えてください');
    };
    document.getElementById('addForm').onsubmit = function(e) {
      e.preventDefault();
      const jp = document.getElementById('newJp').value.trim();
      const en = document.getElementById('newEn').value.trim();
      if(jp && en) {
        words.push({ jp: jp, en: en });
        document.getElementById('newJp').value = '';
        document.getElementById('newEn').value = '';
        renderTable();
      }
    };
    document.getElementById('downloadBtn').onclick = function() {
      const txt = words.map(w => `${w.jp},${w.en}`).join('\n');
      const blob = new Blob([txt], {type: "text/plain"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = "words.txt";
      a.click();
      URL.revokeObjectURL(url);
    };
  </script>
</body>
</html>
